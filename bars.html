<!DOCTYPE html>
<html>
  <head>
    <title>Visimusic: Bars</title>
    <link rel="icon" href="Visimusic.png">
    <style>
      body {
        background: black;
        overflow: hidden;
        font-size: 0;
        width: 1366px;
        height: 768px;
      }
      div {
        background: white;
        width: 7px;
        margin-right: 1px;
        margin-left: 1px;
        height: 1px;
        display: inline-block;
      }
    </style>
  </head>
  <body>
    <span style="position: absolute; z-index: 99;">
      <select id="song">
        <option></option>
        <option value="Barracuda">Barracuda</option>
        <option value="Cascade">Cascade</option>
        <option value="Cheat Codes">Cheat Codes</option>
        <option value="Checkpoint">Checkpoint</option>
        <option value="Chip Zeal">Chip Zeal</option>
        <option value="Chronos">Chronos</option>
        <option value="Commando Steve">Commando Steve</option>
        <option value="Cool Friends">Cool Friends</option>
        <option value="Core">Core</option>
        <option value="Corrupted">Corrupted</option>
        <option value="Courtesy">Courtesy</option>
        <option value="Cruise Control">Cruise Control</option>
        <option value="Dance of the Incognizant">Dance of the Incognizant</option>
        <option value="Destroid 8 - Annihilate">Destroid 8 - Annihilate</option>
        <option value="Destroid 10 - Funk Hole">Destroid 10 - Funk Hole</option>
        <option value="Final Boss">Final Boss</option>
        <option value="Focus">Focus</option>
        <option value="FOX">FOX</option>
        <option value="FTW">FTW</option>
        <option value="Houston">Houston</option>
        <option value="HYPE">HYPE</option>
        <option value="Into The Zone">Into The Zone</option>
        <option value="Legacy">Legacy</option>
        <option value="Livewire">Livewire</option>
        <option value="Logic Gatekeeper">Logic Gatekeeper</option>
        <option value="Long Live The New Fresh">Long Live The New Fresh</option>
        <option value="Milky Ways">Milky Ways</option>
        <option value="New Game">New Game</option>
        <option value="On The Run">On The Run</option>
        <option value="Once Again">Once Again</option>
        <option value="Otis">Otis</option>
        <option value="Paper Dolls">Paper Dolls</option>
        <option value="Parallel Processing">Parallel Processing</option>
        <option value="Peer Gynt">Peer Gynt</option>
        <option value="Rainbow Road">Rainbow Road</option>
        <option value="Sevcon">Sevcon</option>
        <option value="Spectra">Spectra</option>
        <option value="Sugar Rush">Sugar Rush</option>
        <option value="Tension">Tension</option>
        <option value="Termination Shock">Termination Shock</option>
        <option value="The Art of War">The Art of War</option>
        <option value="The Lunar Whale">The Lunar Whale</option>
        <option value="Till It's Over">Till It's Over</option>
        <option value="Tokyo Skies">Tokyo Skies</option>
        <option value="Try This">Try This</option>
        <option value="Unlocked">Unlocked</option>
        <option value="Vindicate Me">Vindicate Me</option>
        <option value="Wicked">Wicked</option>
      </select>
      <button onclick="initPage()" id="button">Go</button>
    </span>
    <audio src="" id="audio"></audio>
    <span style="position: absolute; bottom: 0; width: 1500px; z-index: -99;">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div style="height: 1000px; background: black;"></div>
    </span>
  </body>
  <script>
    var bar_height, frequency_array,
        styles = {
          alternating: "alternating",
          sequential: "sequential",
          random: "random",
          single: "single"
        };
    function initPage() {
      var song = document.getElementById("song").value;
      audio = document.getElementById("audio");
      context = new (window.AudioContext || window.webkitAudioContext)();
      analyser = context.createAnalyser();
      audio.src = song + ".mp3";
      source = context.createMediaElementSource(audio);
      source.connect(analyser);
      analyser.connect(context.destination);
      frequency_array = new Uint8Array(analyser.frequencyBinCount);
      analyser.fftSize = 4096;
      analyser.smoothingTimeConstant = 0.25;
      analyser.minDecibels = -75;
      analyser.maxDecibels = -25;
      analyser.getByteFrequencyData(frequency_array);
      document.getElementById("button").style.visibility = "hidden";
      document.getElementById("song").style.visibility = "hidden";
      audio.addEventListener("ended", function() {
        audio.src = "";
        document.getElementById("song").selectedIndex = 0;
        alert(("" + audio.src).slice(0, (audio.src).length - 5) + " has ended. If you wish, feel free to pick another song.");
        var x = 0;
        for (var i = 0; i < 120; i++) {
          setTimeout(function() {
            document.getElementsByTagName("div")[x].style.background = "#ffffff";
            x++;
          }, 5*i);
        }
        document.getElementById("button").style.visibility = "visible";
        document.getElementById("song").style.visibility = "visible";
      });
      var colors, style;
      switch (song) {
        case "Barracuda":
          colors = ["#e7e7e7", "#efefef", "#f7f7f7"];
          style = styles.random;
          break;
        case "Cascade":
          colors = ["#e5af71", "#ac4534", "#e8bc7d"];
          style = styles.random;
          break;
        case "Cheat Codes":
        case "FTW":
        case "Once Again":
        case "Till It\'s Over":
          colors = ["#ffff00"];
          style = styles.single;
          break;
        case "Checkpoint":
          colors = ["#ff4e5b"];
          style = styles.single;
          break;
        case "Chip Zeal":
          colors = ["#ff0000", "#ffff00"];
          style = styles.alternating;
          break;
        case "Chronos":
        case "Corrupted":
        case "Legacy":
        case "Logic Gatekeeper":
        case "Parallel Processing":
        case "The Lunar Whale":
          colors = ["#113344"];
          style = styles.single;
          if (song == "Corrupted") {
            colors[1] = "#ff0080";
            style = styles.alternating;
          }
          break;
        case "Commando Steve":
        case "Milky Ways":
          colors = ["#ff0000", "#ffffff"];
          style = styles.alternating;
          break;
        case "Cool Friends":
          colors = ["#4643d2", "#c38ef8"];
          style = styles.alternating;
          break;
        case "Core":
        case "Cruise Control":
        case "Livewire":
        case "Tension":
          colors = ["#ff8000"];
          style = styles.single;
          break;
        case "Courtesy":
        case "Focus":
        case "Otis":
          colors = ["#0432ea"];
          style = styles.single;
          break;
        case "Dance of the Incognizant":
          colors = ["#cf0200", "#f34b4a", "#a00000", "#871514", "#9f3134"];
          style = styles.random;
          break;
        case "Destroid 8 - Annihilate":
        case "Destroid 10 - Funk Hole":
          colors = ["#ff0000", "#ff3300", "#ff6600", "#ff9900", "#ffcc00", "#ffff00"];
          style = styles.random;
          break;
        case "Final Boss":
          colors = ["#8b008b"];
          style = styles.single;
          break;
        case "FOX":
        case "On The Run":
          colors = ["#008fdd", "#fc00eb", "#6624f8"];
          style = styles.random;
          break;
        case "Houston":
          colors = ["#99ff00"];
          style = styles.single;
          break;
        case "HYPE":
          colors = ["#209f07", "#bae967", "#89e952", "#38fa03", "#8ee050"];
          style = styles.random;
          break;
        case "Into The Zone":
          colors = ["#ff729c", "#fe0b41", "#bb96ff", "#462784"];
          style = styles.random;
          break;
        case "Long Live The New Fresh":
          colors = ["#801b55", "#483872"];
          style = styles.alternating;
          break;
        case "New Game":
          colors = ["#00bf00", "#00c300", "#00c700", "#00ca00", "#00cf00", "#00d300", "#00d700", "#00da00", "#00df00", "#00e300", "#00e700", "#00ea00", "#00ef00", "#00f300", "#00f700", "#00fa00", "#00ff00"];
          style = styles.random;
          break;
        case "Paper Dolls":
          colors = ["#ffffff"];
          style = styles.single;
          break;
        case "Peer Gynt":
          colors = ["#334422", "#fdeed1"];
          style = styles.alternating;
          break;
        case "Rainbow Road":
        case "Spectra":
          colors = ["#ff0000", "#ff2000", "#ff4000", "#ff6000", "#ff8000", "#ff9f00", "#ffbf00", "#ffdf00", "#ffff00", "#dfff00", "#bfff00", "#9fff00", "#80ff00", "#60ff00", "#40ff00", "#20ff00", "#00ff00", "#00ff20", "#00ff40", "#00ff60", "#00ff80", "#00ff9f", "#00ffbf", "#00ffdf", "#00ffff", "#00dfff", "#00bfff", "#009fff", "#0080ff", "#0060ff", "#0040ff", "#0020ff", "#0000ff", "#2000ff", "#4000ff", "#6000ff", "#8000ff", "#9f00ff", "#bf00ff", "#df00ff", "#ff00ff", "#ff00df", "#ff00bf", "#ff009f", "#ff0080", "#ff0060", "#ff0040", "#ff0020"];
          style = styles.sequential;
          break;
        case "Sevcon":
        case "Wicked":
          colors = ["#ff0000"];
          style = styles.single;
          break;
        case "Sugar Rush":
          colors = ["#7fffd4"];
          style = styles.single;
          break;
        case "Termination Shock":
          colors = ["#0000ff", "#00ffff"];
          style = styles.alternating;
          break;
        case "The Art of War":
          colors = ["#ffd700"];
          style = styles.single;
          break;
        case "Tokyo Skies":
          colors = ["#00008b"];
          style = styles.single;
          break;
        case "Try This":
          colors = ["#ff0080"];
          style = styles.single;
          break;
        case "Unlocked":
          colors = ["#eeeeee"];
          style = styles.single;
          break;
        case "Vindicate Me":
          colors = ["#00ff80"];
          style = styles.single;
          break;
      }
      var y = 0;
      for (var i = 0; i < 120; i++) {
        setTimeout(function() {
          switch (style) {
            case "alternating":
            case "sequential":
              document.getElementsByTagName("div")[y].style.background = colors[y % colors.length];
              break;
            case "random":
              document.getElementsByTagName("div")[y].style.background = colors[Math.floor(Math.random() * colors.length)];
              break;
            case "single":
              document.getElementsByTagName("div")[y].style.background = colors[0];
              break;
          }
          y++;
        }, 5*i);
      }
      setTimeout(function() {
        audio.load();
        audio.play();
        animationLooper();
      }, 1000);
    }
    function animationLooper(){
      analyser.getByteFrequencyData(frequency_array);
      for(var i = 0; i < 120; i++){
        bar_height = Math.pow((frequency_array[i] * 4) / 41, 2);
        setH(i, bar_height);
      }
      window.requestAnimationFrame(animationLooper);
    }
    function setH(barID, height) {
      document.getElementsByTagName("div")[barID].style.height = (height+1) + "px";
    }
  </script>
</html>
